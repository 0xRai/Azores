<% layout('layouts/boilerplate') %>
    <link rel="stylesheet" href="/stylesheets/posts.css">
    <div class="community-back">
        <img onclick="location.href='/c/<%= post.community %>'" src="/images/testicon.png" alt="">
    </div>
    <div class="post" mb-3>
        <div class="post-row">
            <div class="post-section">
                <p>
                    <%- post.rating %>
                </p>
            </div>
            <div class="post-section">
                <img onclick="href" src="/images/testicon.png" alt="" class="img-fluid">
            </div>
            <div class="post-section">
                <p>
                    <%- post.title %>
                </p>

                <p>
                    Submitted by
                    <a href="">
                        <%- post.author.username %>
                    </a>
                    on
                    <%- moment(post.dateCreated).format('lll'); %>
                </p>
                <p>
                    <% if(currentUser && post.author.equals(currentUser._id)) { %>
                        <form action="../posts/<%= post._id %>?_method=DELETE" method="POST">
                            <button>Delete</button>
                        </form>
                        <form action="../posts/<%= post._id %>/edit">
                            <button>Edit</button>
                        </form>
                        <% } %>
                </p>

                <hr>
                <div class="post-section">
                    <p>
                        <%- post.body %>
                    </p>
                </div>
                <hr>
                <div class="post-section">
                    <% if(post.comments.length===1) {%>
                        <p>all
                            <%- post.comments.length %> comment
                        </p>
                        <% } else {%>
                            <p>all
                                <%- post.comments.length %> comments
                            </p>
                            <% } %>
                </div>
                <% if(currentUser) { %>
                    <form action="<%= post._id %>/comments" method="POST" novalidate>
                        <div class="post-section">
                            <textarea name="comment[body]" id="body" cols="70" rows="10"></textarea>
                        </div>
                        <div class="post-section">
                            <button>Submit</button>
                        </div>
                    </form>
                    <% } %>
                        <!-- COMMENTS -->
                        <hr>
                        <div class="post" mb-3>
                            <div class="post-row">
                                <div class="post-section">
                                    <% for (let comment of post.comments) { %>
                                        <p>
                                            <a href="">
                                                <%- comment.author.username %>
                                            </a> •
                                            <%- comment.rating %>
                                                •
                                                <%- moment(comment.dateCreated).format('lll') %>
                                        </p>
                                        <p>
                                            <%- comment.body %>
                                        </p>
                                        <% if(currentUser && comment.author.equals(currentUser._id)) { %>
                                            <form action="../posts/<%= post._id %>/comments/<%= comment._id%>?_method=DELETE" method="POST">
                                                <button>delete</button>
                                            </form>
                                            <% } %>
                                                <hr>
                                                <% } %>

                                </div>
                            </div>
                        </div>